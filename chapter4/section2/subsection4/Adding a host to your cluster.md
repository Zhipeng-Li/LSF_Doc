# Adding a host to your cluster

Use the LSF installation script **lsfinstall** to add new hosts and host types to your cluster.

## Before you begin

Make sure that you have the LSF distribution files for the host types you want to add. For example, to add a Linux system that runs x86-64 Kernel 2.6 and 3.x to your cluster, get the file lsf10.1_linux2.6-glibc2.3-x86_64.tar.Z.

Distribution packages for all supported LSF releases are available for download through [IBM Passport Advantage](http://www.ibm.com/software/howtobuy/passportadvantage/pao_customers.htm).

See [LSF System Requirements](http://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/New IBM Platform LSF Wiki/page/Platform LSF system requirements) on IBM developerWorks for a complete list of supported operating systems.

The following videos provide more help about downloading LSF through IBM Passport Advantage:

- [YouTube](https://www.ibm.com/links?url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DYV1vdpQ3Rwk%26feature%3Dyoutube)
- [IBM Education Assistant](http://publib.boulder.ibm.com/infocenter/ieduasst/v1r1m0/index.jsp?topic=/com.ibm.iea.selfassist/selfassist/1.0/download/HowtoDownloadLSF/HowtoDownloadLSF.html)

## About this task

Adding a host to your cluster has the following major steps:

1. Install LSF binary files for the host type.
2. Add host information to the lsf.cluster.cluster_name file.
3. Set up the new host.

## Procedure

1. Install the binary files for a new host type.

   Use the **lsfinstall** command to add new host types to your cluster. If you already have the distribution files for the host types you want to add, you can skip these steps.

   1. Log on as root to any host that can access the LSF installation script directory.

   2. Change to the installation script directory.

      ```
      # cd /usr/share/lsf/cluster1/10.1/install
      ```

   3. Edit the install.config file to specify the options you want for new host types.

      For more information about the install.config file, see the [IBM Spectrum LSF Configuration Reference](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_config_ref.html?view=kc). For information about the **lsfinstall** command, see [Installing IBM Spectrum LSF on UNIX and Linux](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_unix_install.html?view=kc) and the [IBM Spectrum LSF Command Reference](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_cmd_ref.html?view=kc).

   4. Run the ./lsfinstall -f install.config command.

   5. Follow the steps for host setup in [After Installing LSF](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_unix_install/lsf_installnewunix_configcluster_tsk.html?view=kc) in [Installing IBM Spectrum LSF on UNIX and Linux](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_unix_install.html?view=kc) (or in the lsf_getting_started.html file that is generated by the **lsfinstall** script) to set up the new hosts.

2. Add host information to the lsf.cluster.cluster_name file.

   1. Log on to the LSF master host as the primary LSF administrator.

   2. Edit the LSF_CONFDIR/lsf.cluster.cluster_name file, and add host information for the new host to the Host section.

      - Add the name of the host.

      - Add model or type.

        If you enter the ! keyword in the model and type columns, the host model is automatically detected by **lim** running on the host.

        You might want to use the default values for that host type now, and change them later on when you have more experience or more information.

      - Specify LSF server or client in the server column:

        - 1 (one) indicates an LSF server host.
- 0 (zero) indicates an LSF client-only host.
        
By default, all hosts are considered LSF server hosts.
      
```
      HOSTNAME  model  type      server  r1m  mem  RESOURCES  REXPRI
hosta     !      SUNSOL    1       1.0  4    ()         0
      hostb     !      LINUX     0       1.0  4    ()         0
hostc     !      HPPA      1       1.0  4    ()         0
      End Host
```
      
3. Save the changes to LSF_CONFDIR/lsf.cluster.cluster_name.
   
4. Reconfigure **lim** to enable the new host in the cluster.
   
      ```
   % lsadmin reconfig
      Checking configuration files ...
   No errors found.
      Do you really want to restart LIMs on all hosts? [y/n] y
      Restart LIM on <hosta> ...... done
      Restart LIM on <hostc> ...... done
      Restart LIM on <hostd> ...... done
      ```
   
      The **lsadmin reconfig** command checks for configuration errors. If no unrecoverable errors are found, you are asked to confirm that you want to restart **lim** on all hosts and **lim** is reconfigured. If unrecoverable errors are found, reconfiguration exits.

   5. Reconfigure **mbatchd**.

      ```
   % badmin reconfig
      Checking configuration files ...
      No errors found.
      Do you want to reconfigure? [y/n] y
      Reconfiguration initiated
      ```
   
      The **badmin reconfig** command checks for configuration errors. If no unrecoverable errors are found, you are asked to confirm reconfiguration. If unrecoverable errors are found, reconfiguration exits.
   
3. (Optional) Use the **hostsetup** command to set up the new host.

   1. Log on as root to any host that can access the LSF installation script directory.

   2. Change to the installation script directory.

      ```
      # cd /usr/share/lsf/cluster1/10.1/install
      ```

   3. Run the **hostsetup** command to set up the new host.

      ```
      # ./hostsetup --top="/usr/share/lsf/lsf_62" --boot="y"
      ```

      For information about the **hostsetup** command, see [Installing IBM Spectrum LSF on UNIX and Linux](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_unix_install.html?view=kc) and the [IBM Spectrum LSF Command Reference](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_cmd_ref.html?view=kc).

   4. Start LSF on the new host.

      Run the following commands:

      ```
      # lsadmin limstartup
      # lsadmin resstartup
      # badmin hstartup
      ```

   5. Run the **bhosts** and **lshosts** commands to verify your changes.

      If any host type or host model is UNKNOWN or DEFAULT, see [Working with hosts](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_admin/chap_hosts_working_with.html?view=kc) in [IBM Spectrum LSF Cluster Management and Operations](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_cluster_ops.html?view=kc) to fix the problem.

## Results

- Use dynamic host configuration to add hosts to the cluster without manually changing the LSF configuration. For more information about adding hosts dynamically, see [IBM Spectrum LSF Cluster Management and Operations](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_welcome/lsf_kc_cluster_ops.html?view=kc).
- If you get errors, see [Troubleshooting LSF problems](https://www.ibm.com/support/knowledgecenter/SSWRJV_10.1.0/lsf_admin/chap_troubleshooting_lsf.html?view=kc#v3523448) for help with some common configuration errors.